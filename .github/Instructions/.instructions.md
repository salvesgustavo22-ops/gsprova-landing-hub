applyTo: **

# Copilot Code Review Instructions — GS Aprova

## Project Context
This repository hosts the **GS Aprova landing site**, focused on ENEM and university entrance exam preparation.  
The stack is **Vite + React + TypeScript + Tailwind + shadcn-ui**, deployed to **GitHub Pages**, with **Supabase** integration for data/auth (see `/supabase`).  
Primary goals: **lead capture**, **fast performance**, **responsive UI**, **SEO**, and **clear analytics**.

---

## Technologies Used
- Vite  
- TypeScript  
- React  
- shadcn-ui  
- Tailwind CSS  
- Supabase (folder `/supabase`, using **JavaScript and SQL** for database logic and queries)

---

## Repository Expectations
- `/src` — application code (components, pages, utilities).  
- `/public` — static assets (icons, images, `sitemap.xml`, `robots.txt`, GA verification files if any).  
- `/supabase` — JS/SQL code for DB integration, policies/migrations when applicable.  
- `.github/workflows/` — CI pipelines; includes **`codacy.yml`** for code quality alerts that Copilot must consume to open fix PRs when feasible.

---

## Code Review Standards

### 1) General Code Quality
- **TypeScript only** for new/modified code.  
- **Functional React components**; prefer **arrow functions**.  
- **Single quotes** for strings.  
- Extract reusable components; avoid duplicate logic.  
- Clean import order; imports relative to `/src` where possible.  
- No dead code, no TODOs left without an issue reference.

### 2) Styling (Tailwind + shadcn-ui)
- **Tailwind CSS** exclusively; avoid inline styles.  
- Mobile-first classes; consistent responsive breakpoints.  
- Respect shadcn-ui patterns (variants, sizes, states).  
- Keep spacing/typography tokens consistent across CTAs and forms.

### 3) Accessibility (a11y)
- Sufficient color contrast; visible focus states.  
- Keyboard navigation for all interactive elements.  
- Proper semantic landmarks (`<main>`, `<header>`, `<nav>`, `<section>`, `<footer>`).  
- Descriptive `alt` for images; `aria-*` where necessary.  
- Form inputs with labels and error messages that are screen-reader friendly.

### 4) Performance Budget
- Initial JS bundle target ≤ **180 kB gzip** (update this threshold if needed).  
- Enforce **route-level code splitting** and dynamic imports where appropriate.  
- All images optimized (WebP/AVIF) with `loading="lazy"` and explicit width/height.  
- Avoid blocking fonts; prefer `font-display: swap`.  
- Lighthouse (or equivalent) score targets in CI: **Performance ≥ 90**.

### 5) SEO & Metadata
- Unique `<title>` and `<meta name="description">` per route/page.  
- `<html lang="pt-BR">`; canonical link per page.  
- Open Graph + Twitter Card tags for shareable pages.  
- **Sitemap & robots** must reflect routing changes (see “SEO & Analytics Review”).  
- Internal/external **link checker** should pass (no 404, no redirects chains).

### 6) Analytics & Events (Google Analytics)
- GA/gtag must run **production-only**.  
- Event names follow a single convention (e.g., `snake_case`):  
  - Example: `cta_whatsapp_click`, `form_submit_lead`, `hero_primary_cta_click`.  
- CTAs and new pages **must** add/update the relevant events.  
- If a consent mechanism exists, **do not fire events** before consent.

### 7) Supabase (Security & Data)
- Client **must use `anon` key** only; never expose `service_role`.  
- **RLS enabled**; policies committed and versioned (SQL) in repo.  
- Prefer **RPC** and parameterized queries; avoid `select *` from client code.  
- Validate env usage: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` only (public, non-sensitive).  
- If migrations are in use, ensure they match current schema.

### 8) Security & Secrets
- No secrets in repo; `.env` ignored; `.env.example` uses placeholders only.  
- Reject PRs that include tokens/keys or sensitive URLs.  
- Respect CodeQL/Codacy security signals.

### 9) Git & Commits
- **Semantic commits** required: `feat:`, `fix:`, `docs:`, `refactor:`, `chore:`, `test:`.  
- Branches from `main` using prefixes `feat/`, `fix/`, `chore/`, etc.  
- PR descriptions must include intent, scope, and testing notes.

---

## Build & Hosting (Vite + GitHub Pages)
- In `vite.config.ts`, ensure `base` matches the GitHub Pages repository path when applicable.  
- Provide **SPA fallback** (`404.html`) for client-side routes.  
- PR fails if `npm run build` breaks or asset paths are incorrect post-build.

---

## Automation & Code Quality
- **Codacy**: `.github/workflows/codacy.yml` handles code review alerts.  
  - Copilot must analyze Codacy findings and may **open PRs** for auto-fixable issues (lint, formatting, minor SEO tags, sitemap/robots updates).  
  - PRs with **Major/Blocker** findings must not be merged.  
- **ESLint + Prettier**: PR must pass lint/format checks.  
- **CodeQL** (recommended): address security alerts before merge.  
- **Lighthouse CI** (recommended): enforce performance threshold.

---

## What Copilot Must Check in Pull Requests
1. TS + React code style adhered; no anti-patterns.  
2. Tailwind/shadcn usage consistent; no inline styles; responsive verified.  
3. a11y checks pass (contrast, focus, keyboard, alt/aria, forms).  
4. Performance budget respected; images optimized; code splitting in place.  
5. SEO metadata complete and correct on new/changed pages.  
6. Supabase usage safe (`anon` only, RLS policies present, no risky queries).  
7. GA production-only, events added/updated for new CTAs/pages with consistent naming.  
8. Commit messages semantic; branch naming correct; tests updated.  
9. Build passes; SPA fallback intact; no broken asset paths.  
10. Codacy/CodeQL alerts addressed; Copilot opens fix PRs where applicable.

---

## SEO & Analytics Review (Explicit Checklist)
When **new pages** are added or **buttons/CTAs** are modified, Copilot must verify:
- `sitemap.xml` includes new/changed routes.  
- `robots.txt` reflects correct indexing/crawling rules for these routes.  
- **Google Analytics** tracking files/config are updated to include the new pages/CTAs.  
- Event tracking exists, is named consistently, and fires in production.  
- Open Graph/Twitter cards updated (if the new page is shareable).  
- No broken links introduced by the change.

---

## CI Expectations (Guidance for Workflows)
- **Node versions**: test/build on Node **18** and **20**.  
- **Package manager**: keep lockfile consistent (npm/yarn/pnpm) and enforce in CI.  
- Jobs to run on PRs:  
  - Install → Type check → ESLint/Prettier → Build (Vite) → Unit tests (Vitest) → E2E smoke (Playwright, optional) → Lighthouse/perf (optional) → Link checker (optional).  
- Fail PRs on: type errors, lint/format errors, failing tests, build failures, perf below target, Major/Blocker Codacy alerts, or missing SEO/analytics updates.

---

## Testing Requirements
- **Vitest** for unit tests (utilities and core components).  
- **Playwright** (or similar) for smoke E2E on core routes and CTAs (including a GA event assertion in production-like builds if feasible).  
- Copilot should propose/extend tests for any new page or component.

---

## Appendix — Event Naming Template
Adopt a single naming style (example: `snake_case`) and apply consistently:
- `cta_whatsapp_click`  
- `cta_contact_submit`  
- `lead_form_open`  
- `lead_form_submit_success`  
- `hero_primary_cta_click`

> If a different style is chosen (e.g., `lowerCamelCase`), apply it uniformly and update this section.
